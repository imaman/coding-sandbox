#!/usr/bin/env bash
set -euo pipefail

IMAGE_NAME="claude-code-dev"
REPO_DIR="${1:?Usage: $0 <repo-dir> [claude args...]}"
REPO_DIR="$(cd "$REPO_DIR" && pwd)"
shift
CLAUDE_DIR="$HOME/.claude"

docker build \
    -t "$IMAGE_NAME" \
    "$(dirname "$0")"

docker run --rm -it \
    -e TERM=xterm-256color \
    -v "$CLAUDE_DIR:/host-claude:ro" \
    -v "$HOME/.claude.json:/host-claude.json:ro" \
    -v "$REPO_DIR:/home/node/repo" \
    "$IMAGE_NAME" claude --dangerously-skip-permissions "$@"
